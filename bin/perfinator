#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'perfinator.rb'

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do # Add args you want: |like,so|
    # your program code here
    # You can access CLI options via
    # the options Hash
    puts options['file']
  end

  # supplemental methods here

  # Declare command-line interface here

  description "HTTP load testing and benchmarking tool with statsd output"
  #
  options['server'] = '8125'
  on("-s STATSD_SERVER", "--server", "StatsD server to send metrics to")
  options['port'] = '8125'
  on("-p STATSD_PORT", "--port", "StatsD port to send metrics to")

  options['concurrent'] = 10
  on('-c NUM', '--concurrent', 'Simulated concurrent users')

  options['requests'] = 500
  on('-n NUM', '--requests', 'Number of requests to make during the test')

  options['delay'] = 2
  on('-d SECONDS', '--delay', 'Time delay between requests by a given simulated user')

  on('-f FILE', '--file', 'File containing URLs to get')

  on("--[no-]random","Select URLs from list randomly")


#  arg :file
#  arg :server, :optional
#  arg :port, :optional
  # Require an argument
  # arg :some_arg 
  #
  # # Make an argument optional
  # arg :optional_arg, :optional

  version Perfinator::VERSION

  use_log_level_option :toggle_debug_on_signal => 'USR1'

  go!
end
